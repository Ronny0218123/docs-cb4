<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="logging">
  
  <title>Logging</title>
  
  <shortdesc>
    The <i>Logging</i> facility allows a record to be maintained of important events
    that occur on Couchbase Server. 
  </shortdesc>
  
  <body>
    
    <section>
      
      <title>
        Logging Overview
      </title>
      
      <p>
        The Couchbase Logging facility records important events, and saves the details to logfiles, on disk. Additionally,
        subsets of information are provided on the <b>Logs</b> screen, in Couchbase Web Console. This may
        appear as follows:
      </p>
      
      <p>
        <image href="./picts/loggingScreenBasic.png" id="welcome" align="left" width="720"/>
      </p>
      
      <p>
        On Linux systems, logfiles are saved to <codeph>/opt/couchbase/var/lib/couchbase/logs</codeph>. On MacOS,
        to <codeph>/Users/</codeph><i>username</i><codeph>/Library/Application Support/Couchbase/var/lib/couchbase/logs</codeph>.
        On Windows, <codeph>C:\Program Files\Couchbase\Server\var\lib\couchbase\logs</codeph>. 
      </p>
      
      <p>
        To work with log-data, users must have appropriate permissions. For details on the Couchbase
        <i>Role-Based Access Control</i> (RBAC) system, see
        <xref href="../security/security-authorization.dita" scope="local" format="dita">Authorization</xref>.
      </p>
      
    </section>
    
    <section>
      
      <title>
        Collecting Information
      </title>
      
      <p>
        On each node within a Couchbase Server-cluster, logging is performed continuously. The results can be reviewed
        in the Couchbase Web Console <b>Log</b> screen, and in the <codeph>logs</codeph> directory in the filesystem,
        as described above.
      </p>
      
      <p>
        Additionally, <i>explicit logging</i> can be performed by the user. This allows a 
        complete list of all
        available information and statistics to be generated as required. The list includes everything currently
        on disk, and adds data gathered in real time. Explicit logging can either be performed
        for all nodes in the cluster, or for one or more individual nodes. The results are saved to disk as zip
        files: each zip file contains the log-data generated for an individual node. 
      </p>
      
      <p>
        Explicit logging can be performed by means
        of the Couchbase CLI utility <codeph>cbcollect_info</codeph>.
        The documentation for this utility, provided
        <xref href="../cli/cbcollect-info-tool.dita" scope="local" format="dita">here</xref>, includes
        a complete list of the logfiles that can be created, and a description of the contents of each. 
      </p>
      
      <p>
        Explicit logging can also be performed via the Couchbase Web Console. On the <b>Logs</b> page, left-click on the
        <uicontrol>Collect Information</uicontrol> tab, towards the top:
      </p>
      
      <p>
        <image href="./picts/collectInfo.png" id="collect_info" align="left" width="72"/>
      </p>
      
      <p>
        This brings up the <b>Collect Information</b> screen, which appears as follows:
      </p>
      
      <p>
        <image href="./picts/collectInformationScreen.png" id="collect_info_screen" align="left" width="640"/>
      </p>
      
      <p>
        This allows logs and diagnostic information to be collected either from all or from selected nodes
        within the cluster. It also allows a partial <b>Log Redaction Level</b> to be specified (this is
        described below). The <b>Log Temporary Directory</b> can optionally be used to specify the full pathname
        of a directory
        into which the created zip files are saved: if none is specified, Couchbase Server, uses its own
        default value. The <b>Upload Proxy</b> field takes an optional hostname of a remote system to
        which the specified pathname is applied.
      </p>
      
      <p>
        The <b>Upload to Couchbase</b> checkbox is described below.
      </p>
        
      <p>  
        To start the collection-process, left-click on the <uicontrol>Start Collection</uicontrol>
        button. A notification is displayed, indicating that the collection process is running. When
        the process has completed, the following information is displayed:
      </p>
      
      <p>
        <image href="./picts/collectInformationComplete.png" id="collect_info_complete" align="left" width="720"/>
      </p>
      
      <p>
        As this indicates, a separate set of logfiles has been created for each node in the cluster. Each set of files
        is saved as a zip file, in the stated temporary location.
      </p>
    
    </section>
    
    <section>
      
      <title>
        Uploading Logfiles
      </title>
      
      <p>
        Logfiles can be uploading for inspection by Couchbase Support. File-contents can be <i>redacted</i>, to prohibit
        inspection of private data.
      </p>
      
      <p>
        For information on performing upload and redaction at the command-tool prompt, see
        <xref href="../cli/cbcollect-info-tool.dita" scope="local" format="dita">cbcollect_info</xref>. To perfom these
        activities at the Couchbase Web Console, before starting the collection-process, check the
        <uicontrol>Upload to Couchbase</uicontrol> checkbox:
      </p>
      
      <p>
        <image href="./picts/uploadToCouchbaseCheckbox.png" id="upload_to_couchbase_checkbox" align="left" width="72"/>
      </p>
      
      <p>
        The display changes to the following: 
      </p>
      
      <p>
        <image href="./picts/uploadToCouchbaseDialogBasic.png" id="upload_to_couchbase_dialog_basic" align="left" width="112"/>
      </p>
      
      <p>
        The dialog now features an <b>Upload to Host</b> field, which contains the server-location to which the customer-data
        is uploaded. Fields are also provided for <b>Customer Name</b> (required) and <b>Ticket Number</b> (optional).
      </p>
      
    </section>
    
    <section>
      
      <title>
        Redacting Logfiles
      </title>
      
      <p>
        Optionally, data to be uploaded to Couchbase Support can be <i>redacted</i>. This means that private information
        is removed from the logfiles to be shared with Couchbase Support: versions of the data retained by the customer
        are not affected. Redacted data includes:
      </p>
      
      <ul>
        <li>
          Key/Value pairs in JSON documents
        </li>
        
        <li>
          Usernames
        </li>
        
        <li>
          Query-fields that reference Key/Value pairs and/or usernames
        </li>
        
        <li>
          Names and email addresses retrieved during product registration
        </li>
        
        <li>
          Extended attributes
        </li>
        
      </ul>
        
      <p>
        Non-private notifications are substituted for redacted data. For example, the following logfile-exerpt shows
        a Couchbase username:
      </p>
      
      <codeblock outputclass="language-bash">0ms [I0] {2506} [INFO] (instance - L:421) Effective connection string: 
couchbase://127.0.0.1?username=Administrator&amp;console_log_level=5&amp;;. 
Bucket=default</codeblock>
      
      <p>
        The redacted version of the logfile might appear as follows:
      </p>
      
      <codeblock outputclass="language-bash">0ms [CONFIG] {2506} [INFO] (instance - L:284) Log redaction enabled. 
Previous log entries might not be redacted. Logs have reduced 
identifying information. Diagnosis and support of issues may be 
challenging or not possible in this configuration.
0ms [I0] {2506} [INFO] (instance - L:421) Effective connection string: -REDACTED-. Bucket=-REDACTED-</codeblock>
        
        <p>
          Note that redaction may eliminate some parameters containing non-private data, as well as all 
          paramters containing private.
        </p>
      
    </section>
    
  </body>
 
</topic>
